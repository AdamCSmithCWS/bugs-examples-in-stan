# Cancer: difference in two binomial proportions

```{r cancer_setup,message=FALSE}
library("rstan")
```


The following simple model is drawn from an example in @JohnsonAlbert1999a, using data collected in a @Dorn1954a.  A sample of 86 lung-cancer patients and a sample of 86 controls were questioned about their smoking habits.  The two groups were chosen to represent random samples from a subpopulation of lung-cancer patients and an otherwise similar population of cancer-free individuals.  Of the cancer patients, 83 out of 86 were smokers; among the control group 72 out of 86 were smokers.  The scientific question of interest was to assess the difference between the smoking habits in the two groups.

In implementing this model, we have just two data points (cancer patients and control group) and a binomial sampling model, in which the population proportions of smokers in each group appear as parameters.  Quantities of interest such as the difference in the population proportions and the log of the odds ratio are computed in the generated quantities section. Uniform priors on the population proportions are used in this example.

$$
\begin{aligned}[t]
r_i &\sim \mathsf{Binomial}(n_i, \pi_i)
\end{aligned}
$$
Additionally the difference,
$$
\delta = \pi_1 - \pi_2 ,
$$
and the log-odds ratio,
$$
\lambda = \log\left(\frac{\pi_1}{1 - \pi_1}\right) - \log \left( \frac{\pi_2}{1 - \pi_2} \right) ,
$$

It places uniform priors (Beta priors) are placed on $\pi$,
$$
\begin{aligned}
\pi_i &\sim \mathsf{Beta}(1, 1)
\end{aligned}
$$

The difference between and log odds ratio are defined in the `generated quantities` block.

```{r}
cancer_data <- list(
  r = c(83, 72),
  n = c(86, 86),
  # beta prior on pi
  p_a = rep(1, 2),
  p_b = rep(1, 2)
)
```


```{r results='hide'}
cancer_mod1 <- stan_model("stan/cancer1.stan")
```
```{r echo=FALSE,results='asis',cache=FALSE}
cancer_mod1
```


```{r results='hide'}
cancer_fit1 <- sampling(cancer_mod1, cancer_data)
```
```{r}
cancer_fit1
```

An alternative parameterization directly models the difference in the population proportion.

$$
\begin{aligned}[t]
r_i &\sim \mathsf{Binomial}(n_i, \pi_i) \\
\pi_1 &= \frac{1}{1 + \exp(-(\alpha + \beta)} \\
\pi_2 &= \frac{1}{1 + \exp(-\alpha))}
\end{aligned}
$$
The parameters $\alpha$ and $\beta$ are given weakly informative priors on the log-odds scale,
$$
\begin{aligned}
\alpha &\sim N(0, 10)\\
\beta &\sim N(0, 2.5)
\end{aligned}
$$

```{r cancer_mod2,results='hide'}
cancer_mod2 <- stan_model("stan/cancer2.stan")
```
```{r echo=FALSE,cache=FALSE,results='asis'}
cancer_mod2
```

```{r cancer_data2}
cancer_data2 <- within(cancer_data, {
  p_a <- p_b <- NULL
  a_loc <- b_loc <- 0
  a_scale <- 10
  b_scale <- 2.5
})
```

```{r cancer_fit2,results='hide'}
cancer_fit2 <- sampling(cancer_mod2, cancer_data2)
```
```{r}
cancer_fit2
```
