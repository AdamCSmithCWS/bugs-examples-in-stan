<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Bayesian Model Examples</title>
  <meta name="description" content="Bayesian Model Examples">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Bayesian Model Examples" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/Bayeux-logo.png" />
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Bayesian Model Examples" />
  
  
  <meta name="twitter:image" content="images/Bayeux-logo.png" />

<meta name="author" content="Jeffrey B. Arnold">


<meta name="date" content="2017-06-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="judges.html">
<link rel="next" href="uk92.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="undervote.html"><a href="undervote.html"><i class="fa fa-check"></i><b>1</b> Undervoting for President, by Race: difference in two binomial proportions</a></li>
<li class="chapter" data-level="2" data-path="cancer.html"><a href="cancer.html"><i class="fa fa-check"></i><b>2</b> Cancer: difference in two binomial proportions</a></li>
<li class="chapter" data-level="3" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html"><i class="fa fa-check"></i><b>3</b> A tibble: 2 x 3</a><ul>
<li class="chapter" data-level="3.1" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html#two-sample-binomial-model"><i class="fa fa-check"></i><b>3.1</b> Two Sample Binomial Model</a></li>
<li class="chapter" data-level="3.2" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html#binomial-logit-model-of-the-difference"><i class="fa fa-check"></i><b>3.2</b> Binomial Logit Model of the Difference</a></li>
<li class="chapter" data-level="3.3" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html#questions"><i class="fa fa-check"></i><b>3.3</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="florida.html"><a href="florida.html"><i class="fa fa-check"></i><b>4</b> Florida: Learning About an Unknown Proportion from Survey Data</a></li>
<li class="chapter" data-level="5" data-path="turnout.html"><a href="turnout.html"><i class="fa fa-check"></i><b>5</b> Turnout: logit/probit models for binary data</a><ul>
<li class="chapter" data-level="5.1" data-path="turnout.html"><a href="turnout.html#datas"><i class="fa fa-check"></i><b>5.1</b> Datas</a></li>
<li class="chapter" data-level="5.2" data-path="turnout.html"><a href="turnout.html#logit-model"><i class="fa fa-check"></i><b>5.2</b> Logit Model</a></li>
<li class="chapter" data-level="5.3" data-path="turnout.html"><a href="turnout.html#probit-model"><i class="fa fa-check"></i><b>5.3</b> Probit Model</a></li>
<li class="chapter" data-level="5.4" data-path="turnout.html"><a href="turnout.html#rstanarm"><i class="fa fa-check"></i><b>5.4</b> rstanarm</a></li>
<li class="chapter" data-level="" data-path="turnout.html"><a href="turnout.html#questions-1"><i class="fa fa-check"></i>Questions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cosponsorship.html"><a href="cosponsorship.html"><i class="fa fa-check"></i><b>6</b> Cosponsorship: computing auxiliary quantities from MCMC output</a><ul>
<li class="chapter" data-level="6.1" data-path="cosponsorship.html"><a href="cosponsorship.html#model"><i class="fa fa-check"></i><b>6.1</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reagan.html"><a href="reagan.html"><i class="fa fa-check"></i><b>7</b> Reagan: linear regression with AR(1) disturbances</a><ul>
<li class="chapter" data-level="7.1" data-path="reagan.html"><a href="reagan.html#cochrane-orcuttprais-winsten"><i class="fa fa-check"></i><b>7.1</b> Cochrane-Orcutt/Prais-Winsten</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sophistication.html"><a href="sophistication.html"><i class="fa fa-check"></i><b>8</b> Political Sophistication: item-response modeling with mixed data types</a><ul>
<li class="chapter" data-level="8.1" data-path="sophistication.html"><a href="sophistication.html#data"><i class="fa fa-check"></i><b>8.1</b> Data</a></li>
<li class="chapter" data-level="8.2" data-path="sophistication.html"><a href="sophistication.html#model-1"><i class="fa fa-check"></i><b>8.2</b> Model</a></li>
<li class="chapter" data-level="8.3" data-path="sophistication.html"><a href="sophistication.html#estimation"><i class="fa fa-check"></i><b>8.3</b> Estimation</a></li>
<li class="chapter" data-level="8.4" data-path="sophistication.html"><a href="sophistication.html#questions-extensions"><i class="fa fa-check"></i><b>8.4</b> Questions / Extensions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="legislators.html"><a href="legislators.html"><i class="fa fa-check"></i><b>9</b> Legislators: estimating legislators’ ideal points from voting histories (roll call data)</a><ul>
<li class="chapter" data-level="9.1" data-path="legislators.html"><a href="legislators.html#identification"><i class="fa fa-check"></i><b>9.1</b> Identification</a></li>
<li class="chapter" data-level="9.2" data-path="legislators.html"><a href="legislators.html#th-senate"><i class="fa fa-check"></i><b>9.2</b> 109th Senate</a></li>
<li class="chapter" data-level="9.3" data-path="legislators.html"><a href="legislators.html#identification-by-fixing-legislators-ideal-points"><i class="fa fa-check"></i><b>9.3</b> Identification by Fixing Legislator’s Ideal Points</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="identification-by-fixing-legislators-signs.html"><a href="identification-by-fixing-legislators-signs.html"><i class="fa fa-check"></i><b>10</b> Identification by fixing Legislator’s Signs</a></li>
<li class="chapter" data-level="11" data-path="identification-by-discrimination-parameters-signs.html"><a href="identification-by-discrimination-parameters-signs.html"><i class="fa fa-check"></i><b>11</b> Identification by Discrimination Parameters’ Signs</a><ul>
<li class="chapter" data-level="11.1" data-path="identification-by-discrimination-parameters-signs.html"><a href="identification-by-discrimination-parameters-signs.html#questions-2"><i class="fa fa-check"></i><b>11.1</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="judges.html"><a href="judges.html"><i class="fa fa-check"></i><b>12</b> Judges: estimating the ideological locations of Supreme Court justices</a></li>
<li class="chapter" data-level="13" data-path="resistant.html"><a href="resistant.html"><i class="fa fa-check"></i><b>13</b> Resistant: Outlier-resistant regression via the Student’s <span class="math inline">\(t\)</span> distribution</a><ul>
<li class="chapter" data-level="13.1" data-path="resistant.html"><a href="resistant.html#data-1"><i class="fa fa-check"></i><b>13.1</b> Data</a></li>
<li class="chapter" data-level="13.2" data-path="resistant.html"><a href="resistant.html#reparaterization-standard-deviation-instead-of-scale"><i class="fa fa-check"></i><b>13.2</b> Reparaterization: standard deviation instead of scale</a></li>
<li class="chapter" data-level="" data-path="resistant.html"><a href="resistant.html#questions-3"><i class="fa fa-check"></i>Questions</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="uk92.html"><a href="uk92.html"><i class="fa fa-check"></i><b>14</b> House of Commons elections: modeling with the multivariate Student-<span class="math inline">\(t\)</span> density</a><ul>
<li class="chapter" data-level="14.1" data-path="uk92.html"><a href="uk92.html#questions-4"><i class="fa fa-check"></i><b>14.1</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="campaign.html"><a href="campaign.html"><i class="fa fa-check"></i><b>15</b> Pooling the Polls Over an Election Campaign</a><ul>
<li class="chapter" data-level="15.1" data-path="campaign.html"><a href="campaign.html#data-2"><i class="fa fa-check"></i><b>15.1</b> Data</a></li>
<li class="chapter" data-level="15.2" data-path="campaign.html"><a href="campaign.html#model-2"><i class="fa fa-check"></i><b>15.2</b> Model</a></li>
<li class="chapter" data-level="15.3" data-path="campaign.html"><a href="campaign.html#estimation-1"><i class="fa fa-check"></i><b>15.3</b> Estimation</a></li>
<li class="chapter" data-level="15.4" data-path="campaign.html"><a href="campaign.html#questions-5"><i class="fa fa-check"></i><b>15.4</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="aspirin.html"><a href="aspirin.html"><i class="fa fa-check"></i><b>16</b> Aspirin: Borrowing Strength via Hierarchical Modeling</a><ul>
<li class="chapter" data-level="16.1" data-path="aspirin.html"><a href="aspirin.html#non-centered-parameterization"><i class="fa fa-check"></i><b>16.1</b> Non-centered parameterization</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="corporatism.html"><a href="corporatism.html"><i class="fa fa-check"></i><b>17</b> Corporatism: Hierarchical model for economic growth</a></li>
<li class="chapter" data-level="18" data-path="unidentified.html"><a href="unidentified.html"><i class="fa fa-check"></i><b>18</b> Unidentified: over-parameterization of normal mean</a></li>
<li class="chapter" data-level="19" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html"><i class="fa fa-check"></i><b>19</b> Engines: right-censored failure times</a><ul>
<li class="chapter" data-level="19.1" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html#data-3"><i class="fa fa-check"></i><b>19.1</b> Data</a></li>
<li class="chapter" data-level="19.2" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html#model-3"><i class="fa fa-check"></i><b>19.2</b> Model</a></li>
<li class="chapter" data-level="19.3" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html#estimation-2"><i class="fa fa-check"></i><b>19.3</b> Estimation</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html"><i class="fa fa-check"></i><b>20</b> Truncation: How does Stan deal with truncation?</a><ul>
<li class="chapter" data-level="20.1" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html#stan-model"><i class="fa fa-check"></i><b>20.1</b> Stan Model</a></li>
<li class="chapter" data-level="20.2" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html#estimation-3"><i class="fa fa-check"></i><b>20.2</b> Estimation</a></li>
<li class="chapter" data-level="20.3" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html#questions-6"><i class="fa fa-check"></i><b>20.3</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="genbeetles.html"><a href="genbeetles.html"><i class="fa fa-check"></i><b>21</b> Generalized Beetles: Generalizing Link Functions for Binomial GLMs</a><ul>
<li class="chapter" data-level="21.1" data-path="genbeetles.html"><a href="genbeetles.html#data-4"><i class="fa fa-check"></i><b>21.1</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="negbin.html"><a href="negbin.html"><i class="fa fa-check"></i><b>22</b> Negative Binomial: Estimating Homicides in Census Tracks</a></li>
<li class="chapter" data-level="23" data-path="multivarmissing.html"><a href="multivarmissing.html"><i class="fa fa-check"></i><b>23</b> Multivariate Missing Data</a><ul>
<li class="chapter" data-level="23.1" data-path="multivarmissing.html"><a href="multivarmissing.html#separate-regressions"><i class="fa fa-check"></i><b>23.1</b> Separate Regressions</a></li>
<li class="chapter" data-level="23.2" data-path="multivarmissing.html"><a href="multivarmissing.html#multivariate-normal"><i class="fa fa-check"></i><b>23.2</b> Multivariate Normal</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Model Examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="resistant" class="section level1">
<h1><span class="header-section-number">13</span> Resistant: Outlier-resistant regression via the Student’s <span class="math inline">\(t\)</span> distribution</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;rstan&quot;</span>)</code></pre></div>
<p>Outlying data points can distort estimates of location, such as means or regression coefficients.<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a> Location estimates obtained via maximizing a iid normal likelihood over heavy tailed data will be sensitive to data in the tails (outliers). A popular alternative to normal errors in regression analyses is the Student’s <span class="math inline">\(t\)</span> density, with an unknown degrees of freedom parameter. For low degrees of freedom, the Student’s <span class="math inline">\(t\)</span> distribution has heavier tails than the normal, but tends to the normal as the degrees of freedom parameter increases. Treating the degrees of freedom parameter as an unknown parameter to be estimaetd thus provides a check on the appropriateness of the normal. By embedding a model with location parameters in the Student’s <span class="math inline">\(t\)</span> density, we obtain outlier-resistant estimates of location parameters.</p>
<div id="data-1" class="section level2">
<h2><span class="header-section-number">13.1</span> Data</h2>
<p>To illustrate these ideas, I use data collected by Douglas Grob on incumbency advantage in American congressional elections, 1956-1994 <span class="citation">(Jackman <a href="#ref-Jackman2000a">2000</a>)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">load</span>(<span class="st">&quot;data/resistant.rda&quot;</span>))
<span class="co">#&gt; [1] &quot;resistant&quot;</span>
<span class="kw">glimpse</span>(resistant)
<span class="co">#&gt; List of 6</span>
<span class="co">#&gt;  $ y        : num [1:5090] 46.3 54.3 58.5 57.8 58.5 ...</span>
<span class="co">#&gt;  $ lagy     : num [1:5090] 57 46.3 54.3 58.5 70 ...</span>
<span class="co">#&gt;  $ prvwinpty: num [1:5090] 1 -1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ deminc   : num [1:5090] 0 0 1 1 1 1 0 1 1 1 ...</span>
<span class="co">#&gt;  $ repinc   : num [1:5090] 0 1 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ year     : num [1:5090] 1 2 3 4 6 7 8 10 11 12 ...</span></code></pre></div>
<p>The response variable is the proportion of the two-party vote won by the Democratic candidate in district <span class="math inline">\(i\)</span> at election <span class="math inline">\(t\)</span>. Indicators for Democratic and Republican incumbency are the critical explanatory variables in the analysis. Coefficients on these indicators are regarded as estimates of incumbency advantage. A series of year-specific indicators (<em>fixed effects</em>) are also included in the specification.</p>
<p><span class="math display">\[
\begin{aligned}[t]
y_i &amp;\sim \mathsf{StudentT}(\nu, \mu_i, \sigma) \\
\mu_i &amp;= \alpha + x_i \beta
\end{aligned}
\]</span> The <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\sigma\)</span> parameters are given weakly informative priors (assuming that all <span class="math inline">\(x\)</span> are scaled to have mean 0, standard deviation 1): <span class="math display">\[
\begin{aligned}[t]
\alpha &amp;\sim \mathsf{Normal}(\bar{y}, 10 s_y), \\
\beta &amp;\sim \mathsf{Normal}(0, 2.5 s_y), \\
\sigma &amp;\sim \mathsf{HalfCauchy}(0, 5 s_y) ,
\end{aligned}
\]</span> where <span class="math inline">\(\bar{y}\)</span> is the mean of <span class="math inline">\(y\)</span>, and <span class="math inline">\(s_y\)</span> is the standard deviation of <span class="math inline">\(y\)</span>. The degrees of freedom parameter in the Student’s <span class="math inline">\(t\)</span> distribution is a paramter and given the weakly informative prior suggested by <span class="citation">Juárez and Steel (<a href="#ref-JuarezSteel2010a">2010</a>)</span>, <span class="math display">\[
\nu \sim \mathsf{Gamma}(2, 0.1) .
\]</span> The following code operationalizes this regression model. The conditional density of the vote proportions is <span class="math inline">\(t\)</span>, with unknown degrees of freedom, <span class="math inline">\(\nu.\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resistant_mod &lt;-<span class="st"> </span><span class="kw">stan_model</span>(<span class="st">&quot;stan/resistant.stan&quot;</span>)</code></pre></div>
<pre>
  <code class="stan">data {
  int N;
  vector[N] y;
  int K;
  matrix[N, K] X;
  int Y;
  int<lower = 1, upper = Y> year[N];
  // priors
  real sigma_scale;
  vector[K] beta_loc;
  vector<lower = 0.>[K] beta_scale;
  real alpha_loc;
  real<lower = 0.> alpha_scale;
}
parameters {
  vector[Y] alpha;
  vector[K] beta;
  real<lower = 2.> nu;
  real<lower = 0.> sigma;
  real<lower = 0.> tau;
}
transformed parameters {
  vector[N] mu;
  for (i in 1:N) {
    mu[i] = alpha[year[i]] + X[i] * beta;
  }
}
model{
  // priors for error variance
  sigma ~ cauchy(0., sigma_scale);
  // priors for year intercepts
  alpha ~ normal(alpha_loc, alpha_scale);
    // priors for the regression coefficients
    beta ~ normal(beta_loc, beta_scale);
    // degrees of freedom
    nu ~ gamma(2, 0.1);
    // likelihood
    y ~ student_t(nu, mu, sigma);
}
generated quantities {
  real delta;
  delta = beta[3] + beta[4];
}</code>
</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
resistant_data &lt;-<span class="st"> </span><span class="kw">within</span>(<span class="kw">list</span>(), {
  y &lt;-<span class="st"> </span>resistant<span class="op">$</span>y
  N &lt;-<span class="st"> </span><span class="kw">length</span>(y)
  X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>lagy <span class="op">+</span><span class="st"> </span>prvwinpty <span class="op">+</span><span class="st"> </span>deminc <span class="op">+</span><span class="st"> </span>repinc, <span class="dt">data =</span> resistant) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">scale</span>()
  K &lt;-<span class="st"> </span><span class="kw">ncol</span>(X)
  year &lt;-<span class="st"> </span>resistant<span class="op">$</span>year
  Y &lt;-<span class="st"> </span><span class="kw">max</span>(year)
  <span class="co"># priors</span>
  alpha_loc &lt;-<span class="st"> </span><span class="kw">mean</span>(y)
  alpha_scale &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(y)
  beta_loc &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, K)
  beta_scale &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">2.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(y), K)
  sigma_scale &lt;-<span class="st"> </span><span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(y)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resistant_fit &lt;-<span class="st"> </span><span class="kw">sampling</span>(resistant_mod, <span class="dt">data =</span> resistant_data)
<span class="co">#&gt; Warning: There were 3994 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See</span>
<span class="co">#&gt; http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(resistant_fit, <span class="dt">par =</span> <span class="kw">c</span>(<span class="st">&quot;nu&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;tau&quot;</span>))<span class="op">$</span>summary
<span class="co">#&gt;               mean se_mean    sd       2.5%        25%        50%</span>
<span class="co">#&gt; nu        6.54e+00  0.0483 0.643   5.47e+00   6.05e+00   6.48e+00</span>
<span class="co">#&gt; sigma     5.82e+00  0.0074 0.102   5.63e+00   5.75e+00   5.82e+00</span>
<span class="co">#&gt; beta[1]   1.16e+01  0.0278 0.190   1.13e+01   1.15e+01   1.16e+01</span>
<span class="co">#&gt; beta[2]  -3.19e+00  0.1396 0.364  -3.92e+00  -3.44e+00  -3.15e+00</span>
<span class="co">#&gt; beta[3]   3.92e+00  0.0347 0.266   3.46e+00   3.72e+00   3.92e+00</span>
<span class="co">#&gt; beta[4]  -3.90e+00  0.0312 0.196  -4.31e+00  -4.03e+00  -3.89e+00</span>
<span class="co">#&gt; tau      8.75e+307     Inf   Inf  4.88e+306  4.23e+307  8.56e+307</span>
<span class="co">#&gt;                75%      97.5%   n_eff Rhat</span>
<span class="co">#&gt; nu        6.97e+00   7.95e+00  177.47 1.03</span>
<span class="co">#&gt; sigma     5.90e+00   6.02e+00  190.65 1.03</span>
<span class="co">#&gt; beta[1]   1.17e+01   1.20e+01   46.77 1.08</span>
<span class="co">#&gt; beta[2]  -2.94e+00  -2.57e+00    6.78 1.22</span>
<span class="co">#&gt; beta[3]   4.11e+00   4.45e+00   58.65 1.08</span>
<span class="co">#&gt; beta[4]  -3.78e+00  -3.52e+00   39.69 1.08</span>
<span class="co">#&gt; tau      1.33e+308  1.76e+308 4000.00  NaN</span></code></pre></div>
</div>
<div id="reparaterization-standard-deviation-instead-of-scale" class="section level2">
<h2><span class="header-section-number">13.2</span> Reparaterization: standard deviation instead of scale</h2>
<p>In the Student’s <span class="math inline">\(t\)</span> distribution, the standard deviation is a function of the degrees of freedom. For degrees of freedom <span class="math inline">\(\nu &gt; 2\)</span>, the variance is defined, and <span class="math display">\[
\sigma^* = sd(y) = \sigma \sqrt{ \frac{\nu}{\nu - 2}}
\]</span> This makes the sampling of <span class="math inline">\(\nu\)</span> and <span class="math inline">\(\sigma\)</span> a priori dependent. Instead, we can place priors on the degrees of freedom <span class="math inline">\(\nu\)</span> and the standard deviation <span class="math inline">\(\sigma^*\)</span>, and treat <span class="math inline">\(\sigma\)</span> as a transformed parameter, <span class="math display">\[
\begin{aligned}
\sigma^* &amp;\sim \mathsf{HalfCauchy}{(0, 5)} \\
\sigma &amp;= \sigma^* \sqrt{\frac{\nu - 2}{\nu}} \\
\end{aligned}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resistant_mod2 &lt;-<span class="st"> </span><span class="kw">stan_model</span>(<span class="st">&quot;stan/resistant2.stan&quot;</span>)</code></pre></div>
<pre>
  <code class="stan">data {
  int N;
  vector[N] y;
  int K;
  matrix[N, K] X;
  int Y;
  int<lower = 1, upper = Y> year[N];
  // priors
  real sigma_scale;
  vector[K] beta_loc;
  vector<lower = 0.>[K] beta_scale;
  real alpha_loc;
  real<lower = 0.> alpha_scale;
}
parameters {
  vector[Y] alpha;
  vector[K] beta;
  real<lower = 2.> nu;
  real<lower = 0.> sigma_raw;
  real<lower = 0.> tau;
}
transformed parameters {
  vector[N] mu;
  real sigma;
  for (i in 1:N) {
    mu[i] = alpha[year[i]] + X[i] * beta;
  }
  // paramterization so sigma and
  sigma = sigma_raw * sqrt((nu - 2) / nu);
}
model{
  // priors for the standard deviation
  sigma_raw ~ cauchy(0., sigma_scale);
  // priors for year intercepts
  alpha ~ normal(alpha_loc, alpha_scale);
    // priors for the regression coefficients
    beta ~ normal(beta_loc, beta_scale);
    // degrees of freedom
    nu ~ gamma(2, 0.1);
    // likelihood
    y ~ student_t(nu, mu, sigma);
}
generated quantities {
  real delta;
  delta = beta[3] + beta[4];
}</code>
</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resistant_fit2 &lt;-<span class="st"> </span><span class="kw">sampling</span>(resistant_mod2, <span class="dt">data =</span> resistant_data)
<span class="co">#&gt; Warning: There were 3987 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See</span>
<span class="co">#&gt; http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(resistant_fit2, <span class="dt">par =</span> <span class="kw">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;nu&quot;</span>, <span class="st">&quot;tau&quot;</span>))<span class="op">$</span>summary
<span class="co">#&gt;               mean se_mean    sd       2.5%        25%        50%</span>
<span class="co">#&gt; beta[1]   1.17e+01 0.01250 0.180   1.13e+01   1.15e+01   1.17e+01</span>
<span class="co">#&gt; beta[2]  -3.32e+00 0.03435 0.313  -3.98e+00  -3.52e+00  -3.31e+00</span>
<span class="co">#&gt; beta[3]   3.94e+00 0.02430 0.236   3.45e+00   3.79e+00   3.94e+00</span>
<span class="co">#&gt; beta[4]  -3.97e+00 0.02449 0.214  -4.37e+00  -4.12e+00  -3.97e+00</span>
<span class="co">#&gt; sigma     5.82e+00 0.00512 0.101   5.62e+00   5.75e+00   5.81e+00</span>
<span class="co">#&gt; nu        6.48e+00 0.04144 0.602   5.44e+00   6.06e+00   6.43e+00</span>
<span class="co">#&gt; tau      8.93e+307     Inf   Inf  3.73e+306  4.31e+307  9.00e+307</span>
<span class="co">#&gt;                75%      97.5%  n_eff Rhat</span>
<span class="co">#&gt; beta[1]   1.18e+01   1.20e+01  208.7 1.01</span>
<span class="co">#&gt; beta[2]  -3.10e+00  -2.75e+00   83.1 1.01</span>
<span class="co">#&gt; beta[3]   4.09e+00   4.41e+00   94.6 1.03</span>
<span class="co">#&gt; beta[4]  -3.83e+00  -3.54e+00   76.7 1.05</span>
<span class="co">#&gt; sigma     5.89e+00   6.01e+00  392.1 1.01</span>
<span class="co">#&gt; nu        6.84e+00   7.77e+00  211.1 1.02</span>
<span class="co">#&gt; tau      1.36e+308  1.75e+308 4000.0  NaN</span></code></pre></div>
</div>
<div id="questions-3" class="section level2 unnumbered">
<h2>Questions</h2>
<ol style="list-style-type: decimal">
<li>How does using the Student-t distribution compare to using a normal distribution for the errors? How would you evaluate it.</li>
<li>Compare the effective sample size, <span class="math inline">\(\hat{R}\)</span>, and speed for <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\nu\)</span> when using the scale/degrees of freedom and standard deviation/degrees of freedom parameterizations.</li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Jackman2000a">
<p>Jackman, Simon. 2000. “Estimation and Inference Are Missing Data Problems: Unifying Social Science Statistics via Bayesian Simulation.” <em>Political Analysis</em> 8 (4). [Oxford University Press, Society for Political Methodology]: 307–32. <a href="http://www.jstor.org/stable/25791616" class="uri">http://www.jstor.org/stable/25791616</a>.</p>
</div>
<div id="ref-JuarezSteel2010a">
<p>Juárez, Miguel A., and Mark F. J. Steel. 2010. “Model-Based Clustering of Non-Gaussian Panel Data Based on Skew-t Distributions.” <em>Journal of Business &amp; Economic Statistics</em> 28 (1). Informa UK Limited: 52–66. doi:<a href="https://doi.org/10.1198/jbes.2009.07145">10.1198/jbes.2009.07145</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="9">
<li id="fn9"><p>Example derived from Simon Jackman, “Resistant: Outlier-resistant regression via the t distribution,” 2007-07-24, <a href="https://web-beta.archive.org/web/20070724034107/http://jackman.stanford.edu:80/mcmc/resistant.odc">URL</a>.<a href="resistant.html#fnref9">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="judges.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="uk92.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
