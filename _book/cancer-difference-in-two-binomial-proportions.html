<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Bayesian Models</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Bayesian Models">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Bayesian Models" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Bayesian Models" />
  
  
  

<meta name="author" content="Jeffrey B. Arnold and Simon Jackman">


<meta name="date" content="2017-05-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="learning-about-an-unknown-proportion-from-survey-data.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="cancer-difference-in-two-binomial-proportions.html"><a href="cancer-difference-in-two-binomial-proportions.html"><i class="fa fa-check"></i><b>1</b> Cancer: difference in two binomial proportions</a></li>
<li class="chapter" data-level="2" data-path="learning-about-an-unknown-proportion-from-survey-data.html"><a href="learning-about-an-unknown-proportion-from-survey-data.html"><i class="fa fa-check"></i><b>2</b> Learning About an Unknown Proportion from Survey Data</a></li>
<li class="chapter" data-level="3" data-path="generalized-beetles-generalizing-link-functions-for-binomial-glms.html"><a href="generalized-beetles-generalizing-link-functions-for-binomial-glms.html"><i class="fa fa-check"></i><b>3</b> Generalized Beetles: generalizing link functions for binomial GLMs</a></li>
<li class="chapter" data-level="4" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html"><i class="fa fa-check"></i><b>4</b> Truncation: How does Stan deal with truncation?</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cancer-difference-in-two-binomial-proportions" class="section level1">
<h1><span class="header-section-number">1</span> Cancer: difference in two binomial proportions</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rstan&quot;</span>)</code></pre></div>
<p>The following simple model is drawn from an example in <span class="citation">Johnson and Albert (<a href="#ref-JohnsonAlbert1999a">1999</a>)</span>, using data collected in a <span class="citation">Dorn (<a href="#ref-Dorn1954a">1954</a>)</span>. A sample of 86 lung-cancer patients and a sample of 86 controls were questioned about their smoking habits. The two groups were chosen to represent random samples from a subpopulation of lung-cancer patients and an otherwise similar population of cancer-free individuals. Of the cancer patients, 83 out of 86 were smokers; among the control group 72 out of 86 were smokers. The scientific question of interest was to assess the difference between the smoking habits in the two groups.</p>
<p>In implementing this model, we have just two data points (cancer patients and control group) and a binomial sampling model, in which the population proportions of smokers in each group appear as parameters. Quantities of interest such as the difference in the population proportions and the log of the odds ratio are computed in the generated quantities section. Uniform priors on the population proportions are used in this example.</p>
<p><span class="math display">\[
\begin{aligned}[t]
r_i &amp;\sim \mathsf{Binomial}(n_i, \pi_i)
\end{aligned}
\]</span> Additionally the difference, <span class="math display">\[
\delta = \pi_1 - \pi_2 ,
\]</span> and the log-odds ratio, <span class="math display">\[
\lambda = \log\left(\frac{\pi_1}{1 - \pi_1}\right) - \log \left( \frac{\pi_2}{1 - \pi_2} \right) ,
\]</span></p>
<p>It places uniform priors (Beta priors) are placed on <span class="math inline">\(\pi\)</span>, <span class="math display">\[
\begin{aligned}
\pi_i &amp;\sim \mathsf{Beta}(1, 1)
\end{aligned}
\]</span></p>
<p>The difference between and log odds ratio are defined in the <code>generated quantities</code> block.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_data &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">r =</span> <span class="kw">c</span>(<span class="dv">83</span>, <span class="dv">72</span>),
  <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">86</span>, <span class="dv">86</span>),
  <span class="co"># beta prior on pi</span>
  <span class="dt">p_a =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">2</span>),
  <span class="dt">p_b =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">2</span>)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_mod1 &lt;-<span class="st"> </span><span class="kw">stan_model</span>(<span class="st">&quot;stan/cancer1.stan&quot;</span>)</code></pre></div>
<pre>
  <code class="stan">data {
  int<lower = 0> r[2];
  int<lower = 1> n[2];
  // param for beta prior on p
  vector<lower = 0.>[2] p_a;
  vector<lower = 0.>[2] p_b;
}
parameters {
  vector<lower = 0., upper = 1.>[2] p;
}
model {
  p ~ beta(p_a, p_b);
  r ~ binomial(n, p);
}
generated quantities {
  real delta;
  int delta_up;
  real lambda;
  int lambda_up;

  delta = p[1] - p[2];
  delta_up = delta > 0;
  lambda = logit(p[1]) - logit(p[2]);
  lambda_up = lambda > 0;

}</code>
</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_fit1 &lt;-<span class="st"> </span><span class="kw">sampling</span>(cancer_mod1, cancer_data)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_fit1
<span class="co">#&gt; Inference for Stan model: cancer1.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;             mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="co">#&gt; p[1]        0.95    0.00 0.02   0.90   0.94   0.96   0.97   0.99  2639</span>
<span class="co">#&gt; p[2]        0.83    0.00 0.04   0.75   0.81   0.83   0.86   0.90  2863</span>
<span class="co">#&gt; delta       0.12    0.00 0.04   0.04   0.10   0.12   0.15   0.21  2874</span>
<span class="co">#&gt; delta_up    1.00    0.00 0.05   1.00   1.00   1.00   1.00   1.00  2947</span>
<span class="co">#&gt; lambda      1.55    0.01 0.61   0.44   1.14   1.51   1.94   2.84  2290</span>
<span class="co">#&gt; lambda_up   1.00    0.00 0.05   1.00   1.00   1.00   1.00   1.00  2947</span>
<span class="co">#&gt; lp__      -57.46    0.03 1.04 -60.25 -57.83 -57.14 -56.73 -56.48  1564</span>
<span class="co">#&gt;           Rhat</span>
<span class="co">#&gt; p[1]         1</span>
<span class="co">#&gt; p[2]         1</span>
<span class="co">#&gt; delta        1</span>
<span class="co">#&gt; delta_up     1</span>
<span class="co">#&gt; lambda       1</span>
<span class="co">#&gt; lambda_up    1</span>
<span class="co">#&gt; lp__         1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue May 30 21:48:51 2017.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre></div>
<p>An alternative parameterization directly models the difference in the population proportion.</p>
<p><span class="math display">\[
\begin{aligned}[t]
r_i &amp;\sim \mathsf{Binomial}(n_i, \pi_i) \\
\pi_1 &amp;= \frac{1}{1 + \exp(-(\alpha + \beta)} \\
\pi_2 &amp;= \frac{1}{1 + \exp(-\alpha))}
\end{aligned}
\]</span> The parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are given weakly informative priors on the log-odds scale, <span class="math display">\[
\begin{aligned}
\alpha &amp;\sim N(0, 10)\\
\beta &amp;\sim N(0, 2.5)
\end{aligned}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_mod2 &lt;-<span class="st"> </span><span class="kw">stan_model</span>(<span class="st">&quot;stan/cancer2.stan&quot;</span>)</code></pre></div>
<pre>
  <code class="stan">data {
  int<lower = 0> r[2];
  int<lower = 1> n[2];
  // param for beta prior on p
  real a_loc;
  real<lower = 0.> a_scale;
  real b_loc;
  real<lower = 0.> b_scale;
}
parameters {
  real a;
  real b;
}
transformed parameters {
  vector<lower = 0., upper = 1.>[2] p;
  p[1] = inv_logit(a + b);
  p[2] = inv_logit(a);
}
model {
  a ~ normal(a_loc, a_scale);
  b ~ normal(a_loc, b_scale);
  r ~ binomial(n, p);
}
generated quantities {
  real delta;
  int delta_up;
  real lambda;
  int lambda_up;

  delta = p[1] - p[2];
  delta_up = delta > 0;
  lambda = logit(p[1]) - logit(p[2]);
  lambda_up = lambda > 0;

}</code>
</pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_data2 &lt;-<span class="st"> </span><span class="kw">within</span>(cancer_data, {
  p_a &lt;-<span class="st"> </span>p_b &lt;-<span class="st"> </span><span class="ot">NULL</span>
  a_loc &lt;-<span class="st"> </span>b_loc &lt;-<span class="st"> </span><span class="dv">0</span>
  a_scale &lt;-<span class="st"> </span><span class="dv">10</span>
  b_scale &lt;-<span class="st"> </span><span class="fl">2.5</span>
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_fit2 &lt;-<span class="st"> </span><span class="kw">sampling</span>(cancer_mod2, cancer_data2)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cancer_fit2
<span class="co">#&gt; Inference for Stan model: cancer2.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;             mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="co">#&gt; a           1.69    0.01 0.29   1.16   1.49   1.68   1.89   2.29  1795</span>
<span class="co">#&gt; b           1.66    0.02 0.64   0.53   1.21   1.62   2.07   3.00  1727</span>
<span class="co">#&gt; p[1]        0.96    0.00 0.02   0.92   0.95   0.96   0.98   0.99  2720</span>
<span class="co">#&gt; p[2]        0.84    0.00 0.04   0.76   0.82   0.84   0.87   0.91  1881</span>
<span class="co">#&gt; delta       0.12    0.00 0.04   0.04   0.09   0.12   0.15   0.21  1653</span>
<span class="co">#&gt; delta_up    1.00    0.00 0.04   1.00   1.00   1.00   1.00   1.00  4000</span>
<span class="co">#&gt; lambda      1.66    0.02 0.64   0.53   1.21   1.62   2.07   3.00  1727</span>
<span class="co">#&gt; lambda_up   1.00    0.00 0.04   1.00   1.00   1.00   1.00   1.00  4000</span>
<span class="co">#&gt; lp__      -52.43    0.03 1.01 -55.09 -52.80 -52.13 -51.74 -51.47  1502</span>
<span class="co">#&gt;           Rhat</span>
<span class="co">#&gt; a            1</span>
<span class="co">#&gt; b            1</span>
<span class="co">#&gt; p[1]         1</span>
<span class="co">#&gt; p[2]         1</span>
<span class="co">#&gt; delta        1</span>
<span class="co">#&gt; delta_up     1</span>
<span class="co">#&gt; lambda       1</span>
<span class="co">#&gt; lambda_up    1</span>
<span class="co">#&gt; lp__         1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue May 30 21:49:40 2017.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre></div>

</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-JohnsonAlbert1999a">
<p>Johnson, Valen E., and James H. Albert. 1999. <em>Ordinal Data Modeling</em>. Springer-Verlag. doi:<a href="https://doi.org/10.1007/b98832">10.1007/b98832</a>.</p>
</div>
<div id="ref-Dorn1954a">
<p>Dorn, Harold F. 1954. “The Relationship of Cancer of the Lung and the Use of Tobacco.” <em>The American Statistician</em> 8 (5). [American Statistical Association, Taylor &amp; Francis, Ltd.]: 7–13. <a href="http://www.jstor.org/stable/2681545" class="uri">http://www.jstor.org/stable/2681545</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="learning-about-an-unknown-proportion-from-survey-data.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
