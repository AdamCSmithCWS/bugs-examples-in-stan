<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Bayesian Model Examples</title>
  <meta name="description" content="Bayesian Model Examples">
  <meta name="generator" content="bookdown 0.7.7 and GitBook 2.6.7">

  <meta property="og:title" content="Bayesian Model Examples" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Bayesian Model Examples" />
  
  
  

<meta name="author" content="Jeffrey B. Arnold and Simon Jackman">


<meta name="date" content="2018-04-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="campaign.html">
<link rel="next" href="corporatism.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="dependencies.html"><a href="dependencies.html"><i class="fa fa-check"></i>Dependencies</a></li>
<li class="chapter" data-level="" data-path="colonophon.html"><a href="colonophon.html"><i class="fa fa-check"></i>Colonophon</a></li>
<li class="chapter" data-level="1" data-path="undervote.html"><a href="undervote.html"><i class="fa fa-check"></i><b>1</b> Undervoting for President, by Race: Difference in Two Binomial Proportions</a><ul>
<li class="chapter" data-level="" data-path="undervote.html"><a href="undervote.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cancer.html"><a href="cancer.html"><i class="fa fa-check"></i><b>2</b> Cancer: difference in two binomial proportions</a></li>
<li class="chapter" data-level="3" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html"><i class="fa fa-check"></i><b>3</b> A tibble: 2 x 3</a><ul>
<li class="chapter" data-level="3.1" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html#two-sample-binomial-model"><i class="fa fa-check"></i><b>3.1</b> Two Sample Binomial Model</a></li>
<li class="chapter" data-level="3.2" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html#binomial-logit-model-of-the-difference"><i class="fa fa-check"></i><b>3.2</b> Binomial Logit Model of the Difference</a></li>
<li class="chapter" data-level="3.3" data-path="a-tibble-2-x-3.html"><a href="a-tibble-2-x-3.html#questions"><i class="fa fa-check"></i><b>3.3</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="florida.html"><a href="florida.html"><i class="fa fa-check"></i><b>4</b> Florida: Learning About an Unknown Proportion from Survey Data</a></li>
<li class="chapter" data-level="5" data-path="turnout.html"><a href="turnout.html"><i class="fa fa-check"></i><b>5</b> Turnout: logit/probit models for binary data</a><ul>
<li class="chapter" data-level="5.1" data-path="turnout.html"><a href="turnout.html#data"><i class="fa fa-check"></i><b>5.1</b> Data</a></li>
<li class="chapter" data-level="5.2" data-path="turnout.html"><a href="turnout.html#logit-model"><i class="fa fa-check"></i><b>5.2</b> Logit Model</a></li>
<li class="chapter" data-level="5.3" data-path="turnout.html"><a href="turnout.html#probit-model"><i class="fa fa-check"></i><b>5.3</b> Probit Model</a></li>
<li class="chapter" data-level="5.4" data-path="turnout.html"><a href="turnout.html#rstanarm"><i class="fa fa-check"></i><b>5.4</b> rstanarm</a></li>
<li class="chapter" data-level="" data-path="turnout.html"><a href="turnout.html#questions-1"><i class="fa fa-check"></i>Questions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cosponsorship.html"><a href="cosponsorship.html"><i class="fa fa-check"></i><b>6</b> Cosponsorship: computing auxiliary quantities from MCMC output</a><ul>
<li class="chapter" data-level="6.1" data-path="cosponsorship.html"><a href="cosponsorship.html#model"><i class="fa fa-check"></i><b>6.1</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reagan.html"><a href="reagan.html"><i class="fa fa-check"></i><b>7</b> Reagan: linear regression with AR(1) disturbances</a><ul>
<li class="chapter" data-level="7.1" data-path="reagan.html"><a href="reagan.html#cochrane-orcuttprais-winsten"><i class="fa fa-check"></i><b>7.1</b> Cochrane-Orcutt/Prais-Winsten</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sophistication.html"><a href="sophistication.html"><i class="fa fa-check"></i><b>8</b> Political Sophistication: item-response modeling with mixed data types</a><ul>
<li class="chapter" data-level="8.1" data-path="sophistication.html"><a href="sophistication.html#data-1"><i class="fa fa-check"></i><b>8.1</b> Data</a></li>
<li class="chapter" data-level="8.2" data-path="sophistication.html"><a href="sophistication.html#model-1"><i class="fa fa-check"></i><b>8.2</b> Model</a></li>
<li class="chapter" data-level="8.3" data-path="sophistication.html"><a href="sophistication.html#estimation"><i class="fa fa-check"></i><b>8.3</b> Estimation</a></li>
<li class="chapter" data-level="8.4" data-path="sophistication.html"><a href="sophistication.html#questions-extensions"><i class="fa fa-check"></i><b>8.4</b> Questions / Extensions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="legislators.html"><a href="legislators.html"><i class="fa fa-check"></i><b>9</b> Legislators: Estimating Legislators’ Ideal Points From Voting Histories</a><ul>
<li class="chapter" data-level="9.1" data-path="legislators.html"><a href="legislators.html#identification"><i class="fa fa-check"></i><b>9.1</b> Identification</a></li>
<li class="chapter" data-level="9.2" data-path="legislators.html"><a href="legislators.html#th-senate"><i class="fa fa-check"></i><b>9.2</b> 109th Senate</a></li>
<li class="chapter" data-level="9.3" data-path="legislators.html"><a href="legislators.html#identification-by-fixing-legislators-ideal-points"><i class="fa fa-check"></i><b>9.3</b> Identification by Fixing Legislator’s Ideal Points</a></li>
<li class="chapter" data-level="9.4" data-path="legislators.html"><a href="legislators.html#identification-by-fixing-legislators-signs"><i class="fa fa-check"></i><b>9.4</b> Identification by Fixing Legislator’s Signs</a></li>
<li class="chapter" data-level="9.5" data-path="legislators.html"><a href="legislators.html#questions-2"><i class="fa fa-check"></i><b>9.5</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="judges.html"><a href="judges.html"><i class="fa fa-check"></i><b>10</b> Judges: estimating the ideological locations of Supreme Court justices</a></li>
<li class="chapter" data-level="11" data-path="resistant.html"><a href="resistant.html"><i class="fa fa-check"></i><b>11</b> Resistant: Outlier-resistant regression via the Student’s <span class="math inline">\(t\)</span> distribution</a><ul>
<li class="chapter" data-level="11.1" data-path="resistant.html"><a href="resistant.html#data-2"><i class="fa fa-check"></i><b>11.1</b> Data</a></li>
<li class="chapter" data-level="" data-path="resistant.html"><a href="resistant.html#questions-3"><i class="fa fa-check"></i>Questions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="uk92.html"><a href="uk92.html"><i class="fa fa-check"></i><b>12</b> House of Commons elections: modeling with the multivariate Student-<span class="math inline">\(t\)</span> density</a><ul>
<li class="chapter" data-level="12.1" data-path="uk92.html"><a href="uk92.html#questions-4"><i class="fa fa-check"></i><b>12.1</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="campaign.html"><a href="campaign.html"><i class="fa fa-check"></i><b>13</b> Pooling the Polls Over an Election Campaign</a><ul>
<li class="chapter" data-level="13.1" data-path="campaign.html"><a href="campaign.html#data-3"><i class="fa fa-check"></i><b>13.1</b> Data</a></li>
<li class="chapter" data-level="13.2" data-path="campaign.html"><a href="campaign.html#model-2"><i class="fa fa-check"></i><b>13.2</b> Model</a></li>
<li class="chapter" data-level="13.3" data-path="campaign.html"><a href="campaign.html#estimation-1"><i class="fa fa-check"></i><b>13.3</b> Estimation</a></li>
<li class="chapter" data-level="13.4" data-path="campaign.html"><a href="campaign.html#questions-5"><i class="fa fa-check"></i><b>13.4</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="aspirin.html"><a href="aspirin.html"><i class="fa fa-check"></i><b>14</b> Aspirin: Borrowing Strength via Hierarchical Modeling</a><ul>
<li class="chapter" data-level="14.1" data-path="aspirin.html"><a href="aspirin.html#non-centered-parameterization"><i class="fa fa-check"></i><b>14.1</b> Non-centered parameterization</a></li>
<li class="chapter" data-level="" data-path="aspirin.html"><a href="aspirin.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="corporatism.html"><a href="corporatism.html"><i class="fa fa-check"></i><b>15</b> Corporatism: Hierarchical model for economic growth</a></li>
<li class="chapter" data-level="16" data-path="unidentified.html"><a href="unidentified.html"><i class="fa fa-check"></i><b>16</b> Unidentified: Over-Parameterization of a Normal Mean</a></li>
<li class="chapter" data-level="17" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html"><i class="fa fa-check"></i><b>17</b> Engines: right-censored failure times</a><ul>
<li class="chapter" data-level="17.1" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html#data-4"><i class="fa fa-check"></i><b>17.1</b> Data</a></li>
<li class="chapter" data-level="17.2" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html#model-3"><i class="fa fa-check"></i><b>17.2</b> Model</a></li>
<li class="chapter" data-level="17.3" data-path="engines-right-censored-failure-times.html"><a href="engines-right-censored-failure-times.html#estimation-2"><i class="fa fa-check"></i><b>17.3</b> Estimation</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html"><i class="fa fa-check"></i><b>18</b> Truncation: How does Stan deal with truncation?</a><ul>
<li class="chapter" data-level="18.1" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html#stan-model"><i class="fa fa-check"></i><b>18.1</b> Stan Model</a></li>
<li class="chapter" data-level="18.2" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html#estimation-3"><i class="fa fa-check"></i><b>18.2</b> Estimation</a></li>
<li class="chapter" data-level="18.3" data-path="truncation-how-does-stan-deal-with-truncation.html"><a href="truncation-how-does-stan-deal-with-truncation.html#questions-6"><i class="fa fa-check"></i><b>18.3</b> Questions</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="genbeetles.html"><a href="genbeetles.html"><i class="fa fa-check"></i><b>19</b> Generalized Beetles: Generalizing Link Functions for Binomial GLMs</a><ul>
<li class="chapter" data-level="19.1" data-path="genbeetles.html"><a href="genbeetles.html#data-5"><i class="fa fa-check"></i><b>19.1</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="negbin.html"><a href="negbin.html"><i class="fa fa-check"></i><b>20</b> Negative Binomial: Estimating Homicides in Census Tracks</a></li>
<li class="chapter" data-level="21" data-path="multivarmissing.html"><a href="multivarmissing.html"><i class="fa fa-check"></i><b>21</b> Multivariate Missing Data</a><ul>
<li class="chapter" data-level="21.1" data-path="multivarmissing.html"><a href="multivarmissing.html#separate-regressions"><i class="fa fa-check"></i><b>21.1</b> Separate Regressions</a></li>
<li class="chapter" data-level="21.2" data-path="multivarmissing.html"><a href="multivarmissing.html#multivariate-normal"><i class="fa fa-check"></i><b>21.2</b> Multivariate Normal</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Model Examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aspirin" class="section level1">
<h1><span class="header-section-number">14</span> Aspirin: Borrowing Strength via Hierarchical Modeling</h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;rstan&quot;</span>)</code></pre>
<p>The following data come from a meta-analysis of heart attack data,<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r">aspirin &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">2.77</span>, <span class="fl">2.50</span>, <span class="fl">1.84</span>, <span class="fl">2.56</span>, <span class="fl">2.31</span>, <span class="fl">-1.15</span>),
         <span class="dt">sd =</span> <span class="kw">c</span>(<span class="fl">1.65</span>, <span class="fl">1.31</span>, <span class="fl">2.34</span>, <span class="fl">1.67</span>, <span class="fl">1.98</span>, <span class="fl">0.90</span>))</code></pre>
<p>Each observation is the results of a study of survivorship following a heart attack (myocardial infarction).
In each study, some victims were given aspirin immediately following their heart attack, while some victims were not.
The observed values of <span class="math inline">\(y\)</span> are the differences in mean survivorship observed in each study.
Additionally each study provided a standard deviations, derived from the relative sizes of the two groups in each study.
<span class="math display">\[
\begin{aligned}[t]
y_i &amp;\sim \mathsf{Normal}(\theta_i, s_i) , \\
\theta_i &amp;\sim \mathsf{Normal}(\mu, \tau) ,
\end{aligned}
\]</span>
where <span class="math inline">\(y_i\)</span> is the mean of each study, and <span class="math inline">\(s_i\)</span> is the standard deviation for each study.
Weakly informative priors are given to the parameters <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>,
<span class="math display">\[
\begin{aligned}[t]
\mu &amp;\sim \mathsf{Normal}(\bar{y}, 10 s_y) , \\
\tau &amp;\sim \mathsf{HalfCauchy}(0, 5 s_y) ,
\end{aligned}
\]</span>
where <span class="math inline">\(\bar{y}\)</span> is the mean of <span class="math inline">\(y\)</span>, and <span class="math inline">\(s_y\)</span> is the standard deviation of <span class="math inline">\(y\)</span>.</p>
<p>Although the data are binomial, the sample sizes are large enough in each study that the normal approximation is valid.
This simplifies the problem by reducing each study’s data to the observed treatment effect and a standard deviation.
The goal of the meta-analysis is to synthesize the six studies, in order to arrive at an overall estimate of the effects of aspirin on survivorship following a heart attack.</p>
<p>This is a simple example of hierarchical modeling.
Via the exchangeability assumption, that the study-specific means have a common prior, the studies “borrow strength” from one another.
This introducing some bias, since each study’s mean mean is shrunk back towards the common mean.
However, the benefit is gaining precision (smaller variance).
We also gain a better estimate of the overall effect of aspirin on survivorship after heart attack than we would get from naively pooling the studies or using the estimate of any one study.</p>
<p>The Stan model for the above model is:</p>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_mod &lt;-<span class="st"> </span><span class="kw">stan_model</span>(<span class="st">&quot;stan/aspirin.stan&quot;</span>)</code></pre>
<pre>
  <code class="stan">data {
  int N;
  vector[N] y;
  vector[N] s;
  real mu_loc;
  real<lower = 0.> mu_scale;
  real<lower = 0.> tau_scale;
  real<lower = 0.> tau_df;
}
parameters {
  vector[N] theta;
  real mu;
  real<lower = 0.> tau;
}
model {
  mu ~ normal(mu_loc, mu_scale);
  tau ~ student_t(tau_df, 0., tau_scale);
  theta ~ normal(mu, tau);
  y ~ normal(theta, s);
}
generated quantities {
  vector[N] shrinkage;
  {
    real tau2;
    tau2 = pow(tau, 2.);
    for (i in 1:N) {
      real v;
      v = pow(s[i], 2);
      shrinkage[i] = v / (v + tau2);
    }
  }
}</code>
</pre>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_data &lt;-<span class="st"> </span><span class="kw">within</span>(<span class="kw">list</span>(), {
  y &lt;-<span class="st"> </span>aspirin<span class="op">$</span>y
  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(aspirin)
  s &lt;-<span class="st"> </span>aspirin<span class="op">$</span>sd
  mu_loc &lt;-<span class="st"> </span><span class="kw">mean</span>(y)
  mu_scale &lt;-<span class="st"> </span><span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(y)
  tau_scale &lt;-<span class="st"> </span><span class="fl">2.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(y)
  tau_df &lt;-<span class="st"> </span><span class="dv">4</span>
})</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_fit &lt;-<span class="st"> </span><span class="kw">sampling</span>(aspirin_mod, <span class="dt">data =</span> aspirin_data)
<span class="co">#&gt; Warning: There were 25 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See</span>
<span class="co">#&gt; http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_fit
<span class="co">#&gt; Inference for Stan model: aspirin.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat</span>
<span class="co">#&gt; theta[1]      2.10    0.03 1.32  -0.35  1.20  2.03  2.97  4.77  2715    1</span>
<span class="co">#&gt; theta[2]      2.04    0.02 1.12  -0.07  1.27  2.01  2.79  4.26  2065    1</span>
<span class="co">#&gt; theta[3]      1.62    0.03 1.51  -1.27  0.65  1.58  2.55  4.79  2788    1</span>
<span class="co">#&gt; theta[4]      1.98    0.03 1.30  -0.42  1.09  1.90  2.84  4.69  2601    1</span>
<span class="co">#&gt; theta[5]      1.81    0.03 1.41  -0.75  0.84  1.73  2.72  4.82  2919    1</span>
<span class="co">#&gt; theta[6]     -0.44    0.02 0.91  -2.27 -1.04 -0.43  0.16  1.28  2302    1</span>
<span class="co">#&gt; mu            1.52    0.02 1.09  -0.54  0.82  1.50  2.17  3.75  2140    1</span>
<span class="co">#&gt; tau           1.82    0.02 0.95   0.55  1.15  1.62  2.28  4.19  1495    1</span>
<span class="co">#&gt; shrinkage[1]  0.51    0.01 0.21   0.13  0.34  0.51  0.67  0.90  1270    1</span>
<span class="co">#&gt; shrinkage[2]  0.42    0.01 0.21   0.09  0.25  0.40  0.57  0.85  1181    1</span>
<span class="co">#&gt; shrinkage[3]  0.65    0.01 0.20   0.24  0.51  0.68  0.81  0.95  1394    1</span>
<span class="co">#&gt; shrinkage[4]  0.52    0.01 0.21   0.14  0.35  0.52  0.68  0.90  1275    1</span>
<span class="co">#&gt; shrinkage[5]  0.59    0.01 0.21   0.18  0.43  0.60  0.75  0.93  1336    1</span>
<span class="co">#&gt; shrinkage[6]  0.28    0.01 0.18   0.04  0.13  0.24  0.38  0.73  1046    1</span>
<span class="co">#&gt; lp__         -7.66    0.08 2.59 -13.47 -9.23 -7.44 -5.87 -3.26  1033    1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Apr 20 01:20:48 2018.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre>
<p>Note that this model is likely to produce divergent transitions.
The reasons for this and an alternative parameterization is discussed in the next section.</p>
<div id="non-centered-parameterization" class="section level2">
<h2><span class="header-section-number">14.1</span> Non-centered parameterization</h2>
<p>For few data, when there are not many groups, or when inter-group variation is high, it can be more efficient to use the non-centered parameterization. See <span class="citation">Stan Development Team (<a href="#ref-Stan2016a">2016</a>, 331)</span> and <span class="citation">Betancourt and Girolami (<a href="#ref-BetancourtGirolami2013a">2013</a>)</span> for a more detailed discussion of this.</p>
<p>The non-centered parameterization is
<span class="math display">\[
\begin{aligned}[t]
\theta_i^{*} &amp;\sim \mathsf{Normal}(0, 1) , \\
\theta_i &amp;= \tau \theta^*_i + \mu .
\end{aligned}
\]</span></p>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_mod2 &lt;-<span class="st"> </span><span class="kw">stan_model</span>(<span class="st">&quot;stan/aspirin2.stan&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_mod2</code></pre>
<pre>
  <code class="stan">data {
  int N;
  vector[N] y;
  vector[N] s;
  real mu_loc;
  real<lower = 0.> mu_scale;
  real<lower = 0.> tau_scale;
  real<lower = 0.> tau_df;
}
parameters {
  vector[N] theta_raw;
  real mu;
  real<lower = 0.> tau;
}
transformed parameters {
  vector[N] theta;
  theta = tau * theta_raw + mu;
}
model {
  mu ~ normal(mu_loc, mu_scale);
  tau ~ student_t(tau_df, 0., tau_scale);
  theta_raw ~ normal(0., 1.);
  y ~ normal(theta, s);
}
generated quantities {
  vector[N] shrinkage;
  {
    real tau2;
    tau2 = pow(tau, 2.);
    for (i in 1:N) {
      real v;
      v = pow(s[i], 2);
      shrinkage[i] = v / (v + tau2);
    }
  }
}</code>
</pre>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_fit2 &lt;-<span class="st"> </span><span class="kw">sampling</span>(aspirin_mod2, <span class="dt">data =</span> aspirin_data,
                        <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">aspirin_fit2
<span class="co">#&gt; Inference for Stan model: aspirin2.</span>
<span class="co">#&gt; 4 chains, each with iter=2000; warmup=1000; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=1000, total post-warmup draws=4000.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat</span>
<span class="co">#&gt; theta_raw[1]  0.33    0.01 0.78  -1.21 -0.18  0.32  0.83  1.87  2757    1</span>
<span class="co">#&gt; theta_raw[2]  0.31    0.02 0.76  -1.25 -0.18  0.31  0.79  1.83  2288    1</span>
<span class="co">#&gt; theta_raw[3]  0.06    0.02 0.84  -1.58 -0.50  0.06  0.63  1.72  3065    1</span>
<span class="co">#&gt; theta_raw[4]  0.26    0.02 0.79  -1.26 -0.26  0.25  0.77  1.83  2484    1</span>
<span class="co">#&gt; theta_raw[5]  0.15    0.02 0.81  -1.47 -0.39  0.17  0.70  1.74  2776    1</span>
<span class="co">#&gt; theta_raw[6] -1.14    0.02 0.76  -2.63 -1.64 -1.11 -0.65  0.35  2097    1</span>
<span class="co">#&gt; mu            1.50    0.03 1.04  -0.40  0.84  1.45  2.12  3.71  1381    1</span>
<span class="co">#&gt; tau           1.73    0.03 1.02   0.20  1.06  1.59  2.23  4.33  1141    1</span>
<span class="co">#&gt; theta[1]      2.04    0.02 1.29  -0.27  1.13  1.97  2.89  4.69  4000    1</span>
<span class="co">#&gt; theta[2]      2.00    0.02 1.10   0.02  1.24  1.92  2.73  4.23  4000    1</span>
<span class="co">#&gt; theta[3]      1.59    0.03 1.50  -1.41  0.67  1.54  2.50  4.68  3299    1</span>
<span class="co">#&gt; theta[4]      1.94    0.02 1.29  -0.37  1.02  1.85  2.77  4.69  4000    1</span>
<span class="co">#&gt; theta[5]      1.77    0.02 1.36  -0.76  0.85  1.69  2.61  4.73  4000    1</span>
<span class="co">#&gt; theta[6]     -0.37    0.01 0.95  -2.22 -1.02 -0.37  0.30  1.42  4000    1</span>
<span class="co">#&gt; shrinkage[1]  0.54    0.01 0.23   0.13  0.35  0.52  0.71  0.99  1245    1</span>
<span class="co">#&gt; shrinkage[2]  0.45    0.01 0.24   0.08  0.26  0.40  0.60  0.98  1205    1</span>
<span class="co">#&gt; shrinkage[3]  0.67    0.01 0.21   0.23  0.52  0.68  0.83  0.99  1282    1</span>
<span class="co">#&gt; shrinkage[4]  0.54    0.01 0.23   0.13  0.36  0.52  0.71  0.99  1246    1</span>
<span class="co">#&gt; shrinkage[5]  0.61    0.01 0.22   0.17  0.44  0.61  0.78  0.99  1268    1</span>
<span class="co">#&gt; shrinkage[6]  0.32    0.01 0.24   0.04  0.14  0.24  0.42  0.95  1117    1</span>
<span class="co">#&gt; lp__         -5.13    0.08 2.62 -11.07 -6.64 -4.71 -3.21 -1.18   968    1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Fri Apr 20 01:21:26 2018.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre>
</div>
<div id="references-1" class="section level2 unnumbered">
<h2>References</h2>
<p>This example is derived from Simon Jackman, “Aspirin: Shrinkage (or `borrowing strength’) via hierarchical modeling,” 2007-07-24, <a href="https://web-beta.archive.org/web/20070724034135/http://jackman.stanford.edu:80/mcmc/aspirin.odc">URL</a>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Stan2016a">
<p>Stan Development Team. 2016. <em>Stan Modeling Language Users Guide and Reference Manual, Version 2.14.0</em>. <a href="https://github.com/stan-dev/stan/releases/download/v2.14.0/stan-reference-2.14.0.pdf" class="uri">https://github.com/stan-dev/stan/releases/download/v2.14.0/stan-reference-2.14.0.pdf</a>.</p>
</div>
<div id="ref-BetancourtGirolami2013a">
<p>Betancourt, M. J., and Mark Girolami. 2013. “Hamiltonian Monte Carlo for Hierarchical Models,” December. <a href="http://arxiv.org/abs/1312.0906v1" class="uri">http://arxiv.org/abs/1312.0906v1</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>This example is derived from Simon Jackman, “Aspirin: Shrinkage (or”borrowing strength“) via hierarchical modeling”, 2007-07-24 <a href="https://web-beta.archive.org/web/20070724034135/http://jackman.stanford.edu/mcmc/aspirin.odc">URL</a>. The data and the meta-analysis is from <span class="citation">Draper (<a href="#ref-Draper1992a">1992</a>)</span>.<a href="aspirin.html#fnref12" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="campaign.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="corporatism.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
